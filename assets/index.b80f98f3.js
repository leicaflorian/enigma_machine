var O=Object.defineProperty;var S=(n,t,e)=>t in n?O(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var d=(n,t,e)=>(S(n,typeof t!="symbol"?t+"":t,e),e);import{r as m,d as w,o as l,c,F as _,a as v,b as u,t as g,n as x,e as P,p as $,f as y,w as A,g as U,h as C,u as b,i as T}from"./vendor.5f9e56f0.js";const M=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}};M();const p=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],I={I:{wiring:"EKMFLGDQVZNTOWYHXUSPAIBRCJ",notch:"Y",turnover:"Q"},II:{wiring:"AJDKSIRUXBLHWTMCQGZNPYFVOE",notch:"M",turnover:"E"},III:{wiring:"BDFHJLCPRTXVZNYEIWGAKMUSQO",notch:"D",turnover:"V"},IV:{wiring:"ESOVPZJAYQUIRHXLNFTGKDCMWB",notch:"R",turnover:"J"},V:{wiring:"VZBRGITYUPSDNHLXAWMJQOFECK",notch:"H",turnover:"Z"}};class N extends EventTarget{constructor(t,e,s){super();d(this,"id");d(this,"wiring");d(this,"turnover");d(this,"notch");d(this,"position",m());d(this,"_index");if(!I[t])throw new Error("Unknown configuration");this.id=t,this.turnover=I[t].turnover,this.notch=I[t].notch,this.wiring=I[t].wiring,this.position.value=p.indexOf(e.toUpperCase()),this._index=s}get index(){return this._index}get prevPos(){return this.position.value===0?p.length-1:this.position.value-1}get type(){return this.id}get turnoverIndex(){return p.indexOf(this.turnover)}get letter(){return p[this.position.value]}input(t,e=!1){const s=p.indexOf(t.toUpperCase());let o=s+this.position.value;if(o>=this.wiring.length){const i=o-this.wiring.length;o=0+i}const r=this.wiring[o];return console.log(" - RTR",t,r,s),e&&this.checkRotation(),r}checkRotation(){this._index===0&&this.causeRotation()}causeRotation(t){let e=!t||t==="up"?this.position.value+1:this.position.value-1;e>this.wiring.length-1?e=0:e<0&&(e=this.wiring.length-1),this.position.value=e,console.log("turnover index",this.turnoverIndex,this.position.value,this.prevPos),this.prevPos===this.turnoverIndex&&(!t||t==="up")&&this.dispatchEvent(new CustomEvent("rotorSpun",{detail:{index:this._index,newPosition:this.position.value}})),console.log(` -- newPosition[${this._index}]`,this.position.value)}}class V{constructor(){d(this,"mapping",m(Object.values(p).reduce((t,e,s)=>(t[e]="",t),{})))}get map(){return this.mapping.value}addMap(t,e=""){if(t=t.toUpperCase(),e=e==null?void 0:e.toUpperCase(),t===e)return;const s=Object.entries(this.mapping.value).findIndex(r=>r[1]===t),o=Object.entries(this.mapping.value).findIndex(r=>r[1]===e);console.log(t,s,e,o),s>=0&&(this.mapping.value[p[s]]=""),o>=0&&(this.mapping.value[p[o]]=""),this.mapping.value[t]=e,e&&(this.mapping.value[e]=t)}input(t){const s=(this.mapping.value[t]||t).toUpperCase();return console.log("PLBRD",t,s),s}}const L={A:{wiring:"EJMZALYXVBWFCRQUONTSPIKHGD"},B:{wiring:"YRUHQSLDPXNGOKMIEBFZCWVJAT"},C:{wiring:"FVPJIAOYEDRZXWGCTKUQSBNMHL"}};class k{constructor(t){d(this,"id");d(this,"wiring");if(!L[t])throw new Error("unknown reflector configuration");this.id=t,this.wiring=L[t].wiring}input(t){const e=p.indexOf(t.toUpperCase()),s=this.wiring[e];return console.log("|- RFLCTR",t,s,e),s}}class F extends EventTarget{constructor(t,e,s){super();d(this,"_rotors",[]);d(this,"plugboard");d(this,"reflector");t.forEach((r,i)=>{const a=new N(r,e[i],i);a.addEventListener("rotorSpun",f=>{const h=f.detail.index;h<this._rotors.length-1&&this._rotors[h+1].causeRotation()}),this._rotors.push(a)}),this.plugboard=new V,this.reflector=new k(s);const o=r=>{const i=r.key?r.key.toUpperCase():null;if(!i||!p.includes(i))return;const a=this.input(i);this.dispatchEvent(new CustomEvent("encryption",{detail:a}))};window.removeEventListener("keydown",o),window.addEventListener("keydown",o),window.enigma=this}input(t){let e=this.plugboard.input(t);return e=this.inputThroughRotors(e),e=this.plugboard.input(e),e}get rotorsList(){return this._rotors.reduce((t,e)=>(t.push({letter:e.letter,index:e.index,type:e.type,up:()=>e.causeRotation("up"),down:()=>e.causeRotation("down")}),t),[])}get plugboardMap(){return{map:this.plugboard.map,connect:(t,e)=>this.plugboard.addMap(t,e)}}inputThroughRotors(t){let e=this._rotors[0].input(t,!0),s=this._rotors[1].input(e,!0),o=this._rotors[2].input(s,!0),r=this.reflector.input(o),i=this._rotors[0].input(r),a=this._rotors[1].input(i);return this._rotors[2].input(a)}}var R=(n,t)=>{const e=n.__vccOpts||n;for(const[s,o]of t)e[s]=o;return e};const D=w({name:"LightsBoard",props:{value:String},setup(){return{rows:["QWERTZUIO","ASDFGHJK","PYXCVBNML"]}}}),K={class:"light-board"},H={class:"row mb-2"},J={class:"col"};function Q(n,t,e,s,o,r){return l(),c("div",K,[(l(!0),c(_,null,v(n.rows,i=>(l(),c("div",H,[(l(!0),c(_,null,v(i,a=>(l(),c("div",J,[u("div",{class:x(["letter",{active:n.value===a}])},g(a),3)]))),256))]))),256))])}var Y=R(D,[["render",Q],["__scopeId","data-v-34836950"]]);const Z=w({name:"RotorsBoard",props:{rotors:Array},setup(n){return{sortedRotors:P(()=>[...n.rotors].sort((e,s)=>s.index-e.index))}}}),B=n=>($("data-v-65267f57"),n=n(),y(),n),G={class:"rotors-board"},W={class:"rotor mx-3"},X={class:"btn-group-vertical align-items-center"},j={class:"text-light"},q=["onClick"],z=B(()=>u("i",{class:"fas fa-chevron-up"},null,-1)),tt=[z],et={class:"rotor-letter text-light form-control text-dark text-center"},nt=["onClick"],ot=B(()=>u("i",{class:"fas fa-chevron-down"},null,-1)),st=[ot];function rt(n,t,e,s,o,r){return l(),c("div",G,[(l(!0),c(_,null,v(n.sortedRotors,i=>(l(),c("div",W,[u("div",X,[u("span",j,g(i.index)+" - "+g(i.type),1),u("button",{class:"btn btn-primary",onClick:a=>i.up()},tt,8,q),u("div",et,g(i.letter),1),u("button",{class:"btn btn-primary",onClick:a=>i.down()},st,8,nt)])]))),256))])}var it=R(Z,[["render",rt],["__scopeId","data-v-65267f57"]]);const at=w({name:"PlugBoard",props:{boardOpen:Boolean,value:Object},setup(n,{emit:t}){const e=m(n.boardOpen),s=["QWERTZUIO","ASDFGHJK","PYXCVBNML"];function o(){e.value=!e.value,t("boardStatus",e.value)}function r(i,a){console.log(i,"->",a),n.value.connect(i,a)}return A(()=>n.boardOpen,i=>{e.value=i}),{opened:e,rows:s,toggleStatus:o,onChange:r}}}),E=n=>($("data-v-df1dc6a2"),n=n(),y(),n),ut={class:"container"},lt={class:"text-center py-3"},ct={class:"py-4"},dt={class:"row mb-2"},pt={class:"col"},ht={class:"pin-container"},_t={class:"letter d-flex"},vt=["value","onChange"],gt=E(()=>u("option",{value:""},null,-1)),ft=["value","disabled"],mt=E(()=>u("div",{class:"pins"},null,-1));function wt(n,t,e,s,o,r){return l(),c("div",{class:x(["plug-board",{open:n.opened}])},[u("div",ut,[u("div",lt,[u("button",{class:"btn btn-outline-light",onClick:t[0]||(t[0]=(...i)=>n.toggleStatus&&n.toggleStatus(...i))},[u("i",{class:x(["fas fa-chevron-up",{"fa-rotate-180":n.opened}])},null,2)])]),u("div",ct,[(l(!0),c(_,null,v(n.rows,i=>(l(),c("div",dt,[(l(!0),c(_,null,v(i,a=>(l(),c("div",pt,[u("div",ht,[u("div",_t,[U(g(a)+" -> ",1),u("select",{class:"ms-2 form-select-sm bg-dark text-light",value:n.value.map[a],onChange:f=>n.onChange(a,f.currentTarget.value)},[gt,(l(!0),c(_,null,v(n.value.map,(f,h)=>(l(),c("option",{key:h,value:h,disabled:h===a},g(h),9,ft))),128))],40,vt)]),mt])]))),256))]))),256))])])],2)}var xt=R(at,[["render",wt],["__scopeId","data-v-df1dc6a2"]]);const It=u("h1",{class:"text-light text-center py-3"},"Enigma machine",-1),Ct=w({setup(n){const t=m(null),e=m(!1),s=new F(["III","I","II"],["B","I","A"],"A");return s.addEventListener("encryption",o=>{t.value=o.detail}),(o,r)=>(l(),c("div",{class:x(["container app-container",{"plugboard-opened":e.value}])},[It,C(it,{rotors:b(s).rotorsList},null,8,["rotors"]),C(Y,{value:t.value},null,8,["value"]),C(xt,{boardOpen:e.value,onBoardStatus:r[0]||(r[0]=i=>e.value=i),value:b(s).plugboardMap},null,8,["boardOpen","value"])],2))}});T(Ct).mount("#app");
